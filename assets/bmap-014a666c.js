import{C as T,a as Z,B as E,c as x,b,m as z,d as S,e as V,f as L}from"./useGlobalStagger-62ba6aeb.js";function N(e){var t=T.extend(e);return T.registerClass(t),t}function H(e){var t=Z.extend(e);return Z.registerClass(t),t}function r(e,t){this._bmap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t,this._projection=new BMap.MercatorProjection}r.prototype.type="bmap";r.prototype.dimensions=["lng","lat"];r.prototype.setZoom=function(e){this._zoom=e};r.prototype.setCenter=function(e){this._center=this._projection.lngLatToPoint(new BMap.Point(e[0],e[1]))};r.prototype.setMapOffset=function(e){this._mapOffset=e};r.prototype.getBMap=function(){return this._bmap};r.prototype.dataToPoint=function(e){var t=new BMap.Point(e[0],e[1]),o=this._bmap.pointToOverlayPixel(t),a=this._mapOffset;return[o.x-a[0],o.y-a[1]]};r.prototype.pointToData=function(e){var t=this._mapOffset;return e=this._bmap.overlayPixelToPoint({x:e[0]+t[0],y:e[1]+t[1]}),[e.lng,e.lat]};r.prototype.getViewRect=function(){var e=this._api;return new E(0,0,e.getWidth(),e.getHeight())};r.prototype.getRoamTransform=function(){return x()};r.prototype.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:"bmap",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:b(this.dataToPoint,this),size:b(R,this)}}};r.prototype.convertToPixel=function(e,t,o){return this.dataToPoint(o)};r.prototype.convertFromPixel=function(e,t,o){return this.pointToData(o)};function R(e,t){return t=t||[0,0],z([0,1],function(o){var a=t[o],n=e[o]/2,f=[],l=[];return f[o]=a-n,l[o]=a+n,f[1-o]=l[1-o]=t[1-o],Math.abs(this.dataToPoint(f)[o]-this.dataToPoint(l)[o])},this)}var _;r.dimensions=r.prototype.dimensions;function D(){function e(t){this._root=t}return e.prototype=new BMap.Overlay,e.prototype.initialize=function(t){return t.getPanes().labelPane.appendChild(this._root),this._root},e.prototype.draw=function(){},e}r.create=function(e,t){var o,a=t.getDom();return e.eachComponent("bmap",function(n){var f=t.getZr().painter,l=f.getViewportRoot();if(typeof BMap>"u")throw new Error("BMap api is not loaded");if(_=_||D(),o)throw new Error("Only one bmap component can exist");var i;if(!n.__bmap){var s=a.querySelector(".ec-extension-bmap");s&&(l.style.left="0px",l.style.top="0px",a.removeChild(s)),s=document.createElement("div"),s.className="ec-extension-bmap",s.style.cssText="position:absolute;width:100%;height:100%",a.appendChild(s);var p=n.get("mapOptions");p&&(p=S(p),delete p.mapType),i=n.__bmap=new BMap.Map(s,p);var g=new _(l);i.addOverlay(g),f.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}i=n.__bmap;var m=n.get("center"),c=n.get("zoom");if(m&&c){var y=i.getCenter(),v=i.getZoom(),u=n.centerOrZoomChanged([y.lng,y.lat],v);if(u){var w=new BMap.Point(m[0],m[1]);i.centerAndZoom(w,c)}}o=new r(i,t),o.setMapOffset(n.__mapOffset||[0,0]),o.setZoom(c),o.setCenter(m),n.coordinateSystem=o}),e.eachSeries(function(n){n.get("coordinateSystem")==="bmap"&&(n.coordinateSystem=o)}),o&&[o]};function A(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}N({type:"bmap",getBMap:function(){return this.__bmap},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var o=this.option;return!(A(e,o.center)&&t===o.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},mapStyleV2:{},mapOptions:{},roam:!1}});function B(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}H({type:"bmap",render:function(e,t,o){var a=!0,n=e.getBMap(),f=o.getZr().painter.getViewportRoot(),l=e.coordinateSystem,i=function(w,J){if(!a){var O=f.parentNode.parentNode.parentNode,h=[-parseInt(O.style.left,10)||0,-parseInt(O.style.top,10)||0],d=f.style,C=h[0]+"px",P=h[1]+"px";d.left!==C&&(d.left=C),d.top!==P&&(d.top=P),l.setMapOffset(h),e.__mapOffset=h,o.dispatchAction({type:"bmapRoam",animation:{duration:0}})}};function s(){a||o.dispatchAction({type:"bmapRoam",animation:{duration:0}})}n.removeEventListener("moving",this._oldMoveHandler),n.removeEventListener("moveend",this._oldMoveHandler),n.removeEventListener("zoomend",this._oldZoomEndHandler),n.addEventListener("moving",i),n.addEventListener("moveend",i),n.addEventListener("zoomend",s),this._oldMoveHandler=i,this._oldZoomEndHandler=s;var p=e.get("roam");p&&p!=="scale"?n.enableDragging():n.disableDragging(),p&&p!=="move"?(n.enableScrollWheelZoom(),n.enableDoubleClickZoom(),n.enablePinchToZoom()):(n.disableScrollWheelZoom(),n.disableDoubleClickZoom(),n.disablePinchToZoom());var g=e.__mapStyle,m=e.get("mapStyle")||{},c=JSON.stringify(m);JSON.stringify(g)!==c&&(B(m)||n.setMapStyle(S(m)),e.__mapStyle=JSON.parse(c));var y=e.__mapStyle2,v=e.get("mapStyleV2")||{},u=JSON.stringify(v);JSON.stringify(y)!==u&&(B(v)||n.setMapStyleV2(S(v)),e.__mapStyle2=JSON.parse(u)),a=!1}});V("bmap",r);L({type:"bmapRoam",event:"bmapRoam",update:"updateLayout"},function(e,t){t.eachComponent("bmap",function(o){var a=o.getBMap(),n=a.getCenter();o.setCenterAndZoom([n.lng,n.lat],a.getZoom())})});
